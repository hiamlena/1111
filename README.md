# Trans-Time map: Favicon delivery

<!-- Исправляет ошибку 404 для favicon.ico и добавляет расширенную поддержку наборов favicon -->

## Почему это важно
- **Брендинг и UX:** вкладки, ярлыки на домашнем экране и PWA-карточки используют favicon и apple-touch иконки. Согласованный набор исключает серые заглушки и подчёркивает фирменную палитру.
- **SEO и доверие:** поисковые системы подтягивают иконку в сниппеты; отсутствие или 404 по `/favicon.ico` снижает CTR и засоряет логи.
- **Производительность:** корректные MIME-типы и заголовки `Cache-Control: public, max-age=86400, immutable` позволяют браузеру повторно использовать ассеты без лишних запросов.

## Что реализовано
- Базовые ссылки в `<head>`: `favicon.ico` (логическое имя, проксируется на SVG), адаптивный `favicon.svg` с поддержкой `prefers-color-scheme`, `apple-touch-icon` через data URI, `mask-icon`, `manifest.json`, `theme-color`.
- Клиентский монитор `monitorFaviconHealth()` в `assets/js/yandex.js` отслеживает успешную загрузку через `PerformanceObserver` и предупреждает, если ответа нет.
- Встроенный SVG-fallback: при проблемах с сетевым запросом или отсутствующих ссылках скрипт переключает `<link id="tt-favicon">` на `data:`-иконку без 404.
- Серверная конфигурация `.htaccess` задаёт корректный `Content-Type`, длительный кеш для иконок и переписывает запрос к `/favicon.ico` на `/favicon.svg`, если бинарные ассеты недоступны.

## Чек-лист тестирования
1. Очистить кэш, открыть страницу и убедиться, что `/favicon.ico` и `/favicon.svg` отвечают `200` (либо берутся из кеша) без новых 404 в консоли; убедиться, что `apple-touch-icon` data URI присутствует в `<head>`.
2. Проверить вкладку в Chrome, Firefox, Safari (desktop) и на iOS/Android: иконка, в том числе в тёмной теме, соответствует бренду.
3. В DevTools → Application → Manifest убедиться, что favicon, `theme-color` и manifest подключены.
4. Перезагрузить страницу и убедиться, что в Network favicon помечен как `(from memory cache)`/`(from disk cache)` или `200` ≤1 KB.
5. В консоли видеть сообщение `Favicon обслуживается…`; переименовав временно файл `/favicon.ico`, поймать предупреждение о fallback и убедиться, что иконка продолжает отображаться.
6. Просмотреть серверные логи: после развёртывания отсутствуют новые `404` по `favicon.ico`.

## Дополнительные рекомендации
- Автогенерация ассетов: `npx pwa-asset-generator ./logo.svg ./ --favicon --apple-touch-icon --mask-icon` для синхронизации размеров.
- CI-проверка: добавить шаг `curl -s -o /dev/null -w "%{http_code} %{size_download}" https://example.com/favicon.ico` и проверять, что код `200`, размер > 0.
- Метрики: по событию `faviconLoaded` можно отправлять `window.dataLayer?.push({ event: 'faviconLoaded', source: 'tt' });` для отслеживания отказов.
- Safari pinned tab: при необходимости добавить `mask-icon.svg` с монохромной версией логотипа и обновить атрибут `color` под бренд.

